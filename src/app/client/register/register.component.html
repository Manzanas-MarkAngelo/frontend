<app-time/>

<div class="flex items-start justify-center pt-[3.5rem] bg-primary">
  <div class="bg-white p-6 rounded-xl shadow-lg w-1/2 h-full slide-in-right">
    <div class="flex items-end justify-between">
      <h1 class="text-2xl text-primary font-semibold ml-2 mb-3">
        Fill up fields to register*
      </h1>
      <div class="relative">
        <select
          id="role"
          name="role"
          [(ngModel)]="selectedRole"
          class="appearance-none w-full bg-secondary text-gray-700 
                 font-medium py-3 px-4 pr-8 rounded-xl leading-tight 
                 focus:outline-none focus:bg-[#ffb700] cursor-pointer text-lg">
          <option value="" disabled selected>Role</option>
          <option value="student">Student</option>
          <option value="faculty">Faculty</option>
          <option value="visitor">Visitor</option>
        </select>
        <div class="pointer-events-none absolute inset-y-0 top-0.5 right-2 
                    flex items-center text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" 
               viewBox="0 0 24 24" 
               stroke-width="1.5" stroke="currentColor" class="size-5">
            <path 
              stroke-linecap="round" 
              stroke-linejoin="round" 
              d="m19.5 8.25-7.5 7.5-7.5-7.5" 
            />
          </svg>
        </div>
      </div>
    </div>

    <form (submit)="onSubmit()">
      <div class="mb-4 mt-4 flex items-center space-x-4">
        <ng-container *ngIf="selectedRole === 'student'">
          <div class="relative flex-grow">
            <input
              id="studentNumber"
              name="studentNumber"
              type="text"
              [(ngModel)]="studentNumber"
              placeholder="Enter your PUP ID number here"
              class="mt-1 block w-full rounded-xl border border-gray-300 
                     px-6 py-2 focus:ring-opacity-50 text-lg"
              [ngClass]="{'border-red-500': (!studentNumber && hasFormErrors) || !isStudentNumberValid || isUserExists}"
              (input)="onFieldInput('studentNumber')"
            />
            <span *ngIf="(!studentNumber && hasFormErrors) || !isStudentNumberValid || isUserExists" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500 cursor-pointer group">
              <img src="../../../assets/Exclamation_flat_icon.svg.png" alt="Exclamation Mark" class="h-4 w-4 mt-1"/>
              <span class="absolute right-6 top-1/2 transform -translate-y-1/2 mr-1 w-max 
                           bg-red-500 text-white text-xs rounded py-1 px-2 shadow-lg z-10 
                           whitespace-nowrap group-hover:block hidden">
                {{ !studentNumber && hasFormErrors ? 'Student number cannot be empty.' 
                   : !isStudentNumberValid ? studentNumberError 
                   : isUserExists ? userExistsError : '' }}
              </span>
            </span>
          </div>
        </ng-container>
        <ng-container *ngIf="selectedRole === 'faculty'">
          <div class="relative flex-grow">
            <input
              id="employeeNumber"
              name="employeeNumber" 
              type="text" 
              [(ngModel)]="empNumber" 
              placeholder="Enter your Faculty code here"
              class="mt-1 block w-full rounded-xl border border-gray-300 
                     px-6 py-2 focus:ring-opacity-50 text-lg" 
              [ngClass]="{'border-red-500': (!empNumber && hasFormErrors) || !isEmpNumberValid || isUserExists}"
              (input)="onFieldInput('empNumber')"
            />
            <span *ngIf="(!empNumber && hasFormErrors) || !isEmpNumberValid || isUserExists" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500 cursor-pointer group">
              <img src="../../../assets/Exclamation_flat_icon.svg.png" alt="Exclamation Mark" class="h-4 w-4 mt-1"/>
              <span class="absolute right-6 top-1/2 transform -translate-y-1/2 mr-1 w-max 
                           bg-red-500 text-white text-xs rounded py-1 px-2 shadow-lg z-10 
                           whitespace-nowrap group-hover:block hidden">
                {{ !empNumber && hasFormErrors ? 'Faculty code cannot be empty.' 
                   : !isEmpNumberValid ? empNumberError 
                   : isUserExists ? userExistsError : '' }}
              </span>
            </span>
          </div>
        </ng-container>
        <ng-container *ngIf="selectedRole === 'visitor'">
          <div class="relative flex-grow">
            <input
              id="school" 
              name="school" 
              type="text" 
              [(ngModel)]="school" 
              placeholder="School"
              class="mt-1 block w-full rounded-xl border border-gray-300 
                     px-6 py-2 focus:ring-opacity-50 text-lg" 
              [ngClass]="{'border-red-500': !school && hasFormErrors}"
              (input)="onFieldInput('school')"
            />
            <span *ngIf="!school && hasFormErrors" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500 cursor-pointer group">
              <img src="../../../assets/Exclamation_flat_icon.svg.png" alt="Exclamation Mark" class="h-4 w-4 mt-1"/>
              <span class="absolute right-6 top-1/2 transform -translate-y-1/2 mr-1 w-max 
                           bg-red-500 text-white text-xs rounded py-1 px-2 shadow-lg z-10 
                           whitespace-nowrap group-hover:block hidden">
                School cannot be empty.
              </span>
            </span>
          </div>
        </ng-container>
        <div class="relative mr-44">
          <select
            id="sex" 
            name="sex" 
            [(ngModel)]="sex" 
            class="block appearance-none w-full bg-white text-gray-700 border border-gray-300 
                   font-medium py-3 px-6 pr-8 rounded-xl leading-tight 
                   focus:outline-none focus:bg-white cursor-pointer text-lg mt-1" 
            [ngClass]="{'border-red-500': !sex && hasFormErrors}"
            (input)="onFieldInput('sex')">
            <option value="" disabled selected>Gender</option>
            <option>Male</option>
            <option>Female</option>
          </select>
          <span *ngIf="!sex && hasFormErrors" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500 cursor-pointer group">
            <img src="../../../assets/Exclamation_flat_icon.svg.png" alt="Exclamation Mark" class="h-4 w-4 mt-1"/>
            <span class="absolute right-6 top-1/2 transform -translate-y-1/2 mr-1 w-max 
                         bg-red-500 text-white text-xs rounded py-1 px-2 shadow-lg z-10 
                         whitespace-nowrap group-hover:block hidden">
              Gender must be selected.
            </span>
          </span>
          <div 
            class="pointer-events-none absolute inset-y-0 top-1.5 right-2 
                   flex items-center text-gray-700">
            <svg 
              xmlns="http://www.w3.org/2000/svg" 
              fill="none" 
              viewBox="0 0 24 24" 
              stroke-width="1.5" 
              stroke="currentColor" 
              class="size-5">
              <path 
                stroke-linecap="round" 
                stroke-linejoin="round" 
                d="m19.5 8.25-7.5 7.5-7.5-7.5" 
              />
            </svg>
          </div>
        </div>
      </div>
      <div class="mb-4 mt-1 flex items-center space-x-2">
        <div class="relative flex-grow">
          <input 
            id="fname" 
            name="fname" 
            type="text" 
            [(ngModel)]="firstName" 
            class="mt-1 block w-full rounded-xl border border-gray-300 
                   px-3 pl-6 py-2 focus:ring-opacity-50 text-lg" 
            placeholder="First name" 
            [ngClass]="{'border-red-500': !firstName && hasFormErrors}"
            (input)="onFieldInput('firstName')"
          />
          <span *ngIf="!firstName && hasFormErrors" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500 cursor-pointer group">
            <img src="../../../assets/Exclamation_flat_icon.svg.png" alt="Exclamation Mark" class="h-4 w-4 mt-1"/>
            <span class="absolute right-6 top-1/2 transform -translate-y-1/2 mr-1 w-max 
                         bg-red-500 text-white text-xs rounded py-1 px-2 shadow-lg z-10 
                         whitespace-nowrap group-hover:block hidden">
              First name cannot be empty.
            </span>
          </span>
        </div>
        <div class="relative flex-grow">
          <input 
            id="lname" 
            name="lname" 
            type="text" 
            [(ngModel)]="lastName" 
            class="mt-1 block w-full rounded-xl border border-gray-300
                   px-3 pl-6 py-2 focus:ring-opacity-50 text-lg" 
            placeholder="Last name" 
            [ngClass]="{'border-red-500': !lastName && hasFormErrors}"
            (input)="onFieldInput('lastName')"
          />
          <span *ngIf="!lastName && hasFormErrors" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500 cursor-pointer group">
            <img src="../../../assets/Exclamation_flat_icon.svg.png" alt="Exclamation Mark" class="h-4 w-4 mt-1"/>
            <span class="absolute right-6 top-1/2 transform -translate-y-1/2 mr-1 w-max 
                         bg-red-500 text-white text-xs rounded py-1 px-2 shadow-lg z-10 
                         whitespace-nowrap group-hover:block hidden">
              Last name cannot be empty.
            </span>
          </span>
        </div>

        <div class="relative flex-grow">
          <input 
            id="contact" 
            name="contact" 
            type="text" 
            [(ngModel)]="contact" 
            class="mt-1 block w-full rounded-xl border border-gray-300 
                   px-6 py-2 focus:ring-opacity-50 text-lg" 
            placeholder="Contact number" 
            [ngClass]="{'border-red-500': (!contact && hasFormErrors) || !isContactValid || isContactExists}"
            (input)="onFieldInput('contact')"
          />
          <span *ngIf="(!contact && hasFormErrors) || !isContactValid || isContactExists" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500 cursor-pointer group">
            <img src="../../../assets/Exclamation_flat_icon.svg.png" alt="Exclamation Mark" class="h-4 w-4 mt-1"/>
            <span class="absolute right-6 top-1/2 transform -translate-y-1/2 mr-1 w-max 
                         bg-red-500 text-white text-xs rounded py-1 px-2 shadow-lg z-10 
                         whitespace-nowrap group-hover:block hidden">
                {{ !contact && hasFormErrors ? 'Contact number cannot be empty.' 
                   : !isContactValid ? contactError 
                   : isContactExists ? contactExistsError : '' }}
            </span>
          </span>
        </div>

        <div class="relative mr-44">
          <ng-container *ngIf="selectedRole === 'student'">
            <select 
              id="course"
              name="course" 
              [(ngModel)]="courseId" 
              class="block appearance-none w-auto bg-white border border-gray-300 text-gray-700 
                     font-medium py-3 px-6 pr-8 rounded-xl leading-tight 
                     focus:outline-none focus:bg-white cursor-pointer text-lg mt-1"
              [ngClass]="{'border-red-500': !courseId && hasFormErrors}"
              (input)="onFieldInput('courseId')">
              <option value="" disabled selected>Course</option>
              <option *ngFor="let course of courses" [value]="course.id">
                {{ course.course_abbreviation }}
              </option>
            </select>
            <span *ngIf="!courseId && hasFormErrors" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500 cursor-pointer group">
              <img src="../../../assets/Exclamation_flat_icon.svg.png" alt="Exclamation Mark" class="h-4 w-4 mt-1"/>
              <span class="absolute right-6 top-1/2 transform -translate-y-1/2 mr-1 w-max 
                           bg-red-500 text-white text-xs rounded py-1 px-2 shadow-lg z-10 
                           whitespace-nowrap group-hover:block hidden">
                Course must be selected.
              </span>
            </span>
            <div 
              class="pointer-events-none absolute inset-y-0 top-1.5 right-2 
                    flex items-center text-gray-700">
              <svg 
                xmlns="http://www.w3.org/2000/svg" 
                fill="none" 
                viewBox="0 0 24 24" 
                stroke-width="1.5" 
                stroke="currentColor" 
                class="size-5">
                <path 
                  stroke-linecap="round" 
                  stroke-linejoin="round" 
                  d="m19.5 8.25-7.5 7.5-7.5-7.5" 
                />
              </svg>
            </div>
          </ng-container>
          <ng-container *ngIf="selectedRole === 'faculty'">
            <select 
              id="dept" 
              name="dept" 
              [(ngModel)]="department" 
              class="block appearance-none w-auto bg-white border border-gray-300 text-gray-700 
                     font-medium py-3 px-6 pr-8 rounded-xl leading-tight 
                     focus:outline-none focus:bg-[#ffb700] cursor-pointer text-lg mt-1"
              [ngClass]="{'border-red-500': !department && hasFormErrors}"
              (input)="onFieldInput('department')">
              <option value="" disabled selected>Department</option>
              <option *ngFor="let dept of departments" [value]="dept.id">
                {{ dept.dept_abbreviation }}
              </option>
            </select>
            <span *ngIf="!department && hasFormErrors" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500 cursor-pointer group">
              <img src="../../../assets/Exclamation_flat_icon.svg.png" alt="Exclamation Mark" class="h-4 w-4 mt-1"/>
              <span class="absolute right-6 top-1/2 transform -translate-y-1/2 mr-1 w-max 
                           bg-red-500 text-white text-xs rounded py-1 px-2 shadow-lg z-10 
                           whitespace-nowrap group-hover:block hidden">
                Department must be selected.
              </span>
            </span>
            <div 
              class="pointer-events-none absolute inset-y-0 top-1.5 right-2 
                    flex items-center text-gray-700">
              <svg 
                xmlns="http://www.w3.org/2000/svg" 
                fill="none" 
                viewBox="0 0 24 24" 
                stroke-width="1.5" 
                stroke="currentColor" 
                class="size-5">
                <path 
                  stroke-linecap="round" 
                  stroke-linejoin="round" 
                  d="m19.5 8.25-7.5 7.5-7.5-7.5" 
                />
              </svg>
            </div>
          </ng-container>
        </div>
      </div>

      <div class="mb-4 flex items-center space-x-4">
        <ng-container *ngIf="selectedRole !== 'visitor'">
          <div class="relative flex-grow">
            <input 
              id="email"
              name="email" 
              type="text" 
              [(ngModel)]="email"
              class="mt-1 block w-full rounded-xl border border-gray-300 
                     px-6 py-2 focus:ring-opacity-50 text-lg" 
              placeholder="Email" 
              [ngClass]="{'border-red-500': (!email && hasFormErrors) || !isEmailValid }"
              (input)="onFieldInput('email')"
            />
            <span *ngIf="(!email && hasFormErrors) || !isEmailValid " class="absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500 cursor-pointer group">
              <img src="../../../assets/Exclamation_flat_icon.svg.png" alt="Exclamation Mark" class="h-4 w-4 mt-1"/>
              <span class="absolute right-6 top-1/2 transform -translate-y-1/2 mr-1 w-max 
                           bg-red-500 text-white text-xs rounded py-1 px-2 shadow-lg z-10 
                           whitespace-nowrap group-hover:block hidden">
                {{ !email && hasFormErrors ? 'Email cannot be empty.' 
                   : !isEmailValid ? emailError : '' }}
              </span>
            </span>
          </div>
        </ng-container> 
        <ng-container *ngIf="selectedRole === 'visitor'">
          <div class="relative flex-grow">
            <input
              id="identifier" 
              name="identifier" 
              type="text" 
              [(ngModel)]="identifier" 
              placeholder="Enter your identifier here"
              class="mt-1 block w-full rounded-xl border border-gray-300 
                     px-6 py-2 focus:ring-opacity-50 text-lg" 
              [ngClass]="{'border-red-500': (!identifier && hasFormErrors) || isUserExists}"
              (input)="onFieldInput('identifier')"
            />
            <span *ngIf="(!identifier && hasFormErrors) || isUserExists" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500 cursor-pointer group">
              <img src="../../../assets/Exclamation_flat_icon.svg.png" alt="Exclamation Mark" class="h-4 w-4 mt-1"/>
              <span class="absolute right-6 top-1/2 transform -translate-y-1/2 mr-1 w-max 
                           bg-red-500 text-white text-xs rounded py-1 px-2 shadow-lg z-10 
                           whitespace-nowrap group-hover:block hidden">
                {{ !identifier && hasFormErrors ? 'Identifier cannot be empty.' 
                   : isUserExists ? userExistsError : '' }}
              </span>
            </span>
          </div>
        </ng-container>       
        <button 
          type="submit" 
          class="w-40 bg-primary text-white px-4 py-3 rounded-xl font-medium 
                 hover:bg-[#ffb700] hover:text-black transition duration-300 mt-0.5"
          >
          Register
        </button>
      </div>

      <ng-container *ngIf="selectedRole === 'visitor'">
        <div>
          <span class="text-red-500 font-medium">Please read carefully*</span>
          <p class="text-primary">
            Take note of your identifier. It could be your favorite color, food,
            pet name or anything. You'll need it to log in and out of the
            Library Information System. Thank you!
          </p>
        </div>
      </ng-container>

      <div *ngIf="hasFormErrors" class="text-red-500 text-center mt-2">
        Please fill out all the required fields.
      </div>
    </form>
  </div>
</div>

<dialog id="my_modal_1" class="modal">
  <div class="modal-box">
      <h3 class="text-xl font-bold text-primary text-center">
          Are you sure the details are correct?
      </h3>
      <p class="text-black text-sm text-center my-1">
        Note: Kindly double-check your information to ensure there are no errors.
      </p>
      <div class="flex justify-center items-center gap-2 flex-col mt-5">
        <div *ngIf="selectedRole === 'student'">
          <div><span class="text-primary font-semibold">Role: </span>{{ selectedRole }}</div>
          <div><span class="text-primary font-semibold">Student number: </span>{{ studentNumber }}</div>
          <div><span class="text-primary font-semibold">First name: </span>{{ firstName }}</div>
          <div><span class="text-primary font-semibold">Last name: </span>{{ lastName }}</div>
          <div><span class="text-primary font-semibold">Gender: </span>{{ sex }}</div>
          <div><span class="text-primary font-semibold">Course: </span>{{ getCourseName(courseId) }}</div>
          <div><span class="text-primary font-semibold">Contact number: </span>{{ contact }}</div>
          <div><span class="text-primary font-semibold">Email: </span>{{ email }}</div>
        </div>
        <div *ngIf="selectedRole === 'faculty'">
          <div><span class="text-primary font-semibold">Role: </span>{{ selectedRole }}</div>
          <div><span class="text-primary font-semibold">Faculty code: </span>{{ empNumber }}</div>
          <div><span class="text-primary font-semibold">First name: </span>{{ firstName }}</div>
          <div><span class="text-primary font-semibold">Last name: </span>{{ lastName }}</div>
          <div><span class="text-primary font-semibold">Gender: </span>{{ sex }}</div>
          <div><span class="text-primary font-semibold">Department: </span>{{ getDepartmentName(department) }}</div>
          <div><span class="text-primary font-semibold">Contact number: </span>{{ contact }}</div>
          <div><span class="text-primary font-semibold">Email: </span>{{ email }}</div>
        </div>
        <div *ngIf="selectedRole === 'visitor'">
          <div><span class="text-primary font-semibold">Role: </span>{{ selectedRole }}</div>
          <div><span class="text-primary font-semibold">School: </span>{{ school }}</div>
          <div><span class="text-primary font-semibold">First name: </span>{{ firstName }}</div>
          <div><span class="text-primary font-semibold">Last name: </span>{{ lastName }}</div>
          <div><span class="text-primary font-semibold">Gender: </span>{{ sex }}</div>
          <div><span class="text-primary font-semibold">Contact number: </span>{{ contact }}</div>
          <div><span class="text-primary font-semibold">Identifier: </span>{{ identifier }}</div>
        </div>
      </div>

      <div class="modal-action justify-center items-center">
          <button 
              class="btn w-40 bg-primary text-white hover:bg-[#ffb700] hover:text-black" 
              (click)="closeRequestModal()">
              Close
          </button>
          <button 
              type="button"
              class="btn w-40 bg-secondary text-black hover:bg-[#801e1d] hover:text-white"
              (click)="submitForm()">
              Submit
          </button>
      </div>
  </div>
</dialog>